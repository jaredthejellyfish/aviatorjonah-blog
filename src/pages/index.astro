---
import BaseLayout from '@/layouts/BaseLayout.astro'
import { Globe, ArrowRight } from 'lucide-astro'
import HeroSection from '@/components/HeroSection'
import ArticlesSection from '@/components/ArticlesSection'
import { getArticles, getUser } from '@/lib/supabase'
import { Button } from '@/components/ui/button'
import Footer from '@/components/Footer.astro'

const articles = await getArticles()

if (!articles) {
  return {
    status: 404,
    body: 'Not found',
  }
}

const topThreeArticles = articles?.slice(0, 3)
const articleCount = articles?.length

const { cookies } = Astro

const isLoggedIn =
  cookies.get('sb-access-token') && cookies.get('sb-refresh-token')
    ? true
    : false

const { user } = isLoggedIn ? await getUser() : { user: null }
---

<BaseLayout
  title="AviatorJonah - Blog"
  description="AviatorJonah is a blog about aviation history, the future of aviation, and aviation technology."
>
  <main>
    <HeroSection
      topThreeArticles={topThreeArticles}
      isLoggedIn={isLoggedIn}
      user={user}
      client:load
    />

    <section class="mt-12 flex flex-col gap-4 px-6">
      <span class="text-4xl font-light">Blog</span>
      <span class="text-lg font-extralight text-black/70 dark:text-white/70">
        Here we share our thoughts and ideas about the history of aviation
      </span>
      <ArticlesSection articles={articles} client:load />
    </section>
    <section class="p-2 text-white">
      <div class="grid grid-cols-1 gap-4 sm:grid-cols-2 md:grid-cols-3">
        <div class="flex flex-col gap-4">
          <div class="relative h-[300px] rounded-lg">
            <div
              class="flex flex-col p-3"
              style={{
                position: 'absolute',
                top: 0,
                left: 0,
                bottom: 0,
                right: 0,
                background:
                  'radial-gradient(circle, rgba(0, 0, 0, 0.5) 55%, transparent 1000%)',
                borderRadius: '0.5rem', // Adjust as needed
              }}
            >
              <div
                class="flex h-10 w-10 items-center justify-center rounded-lg border border-neutral-700 bg-neutral-700/50 p-2"
              >
                <Globe class="opacity-70" />
              </div>
              <div class="mt-10 text-xl font-bold sm:text-2xl md:text-3xl">
                Discover our Courses
              </div>
              <div class="mt-2 w-3/4 font-medium opacity-70">
                Lorem ipsum dolor sit amet consectetur adipisicing elit.
                Deleniti tempore reiciendis nesciunt iusto dolore quae, autem
              </div>
              <a href="https://learn.aviatorjonah.com/courses">
                <Button
                  className="mt-4 w-1/3 bg-white text-black hover:bg-white/80"
                  >View Courses <ArrowRight
                    class="ml-2 h-5 w-5 opacity-70"
                  /></Button
                >
              </a>
            </div>

            <img
              src="/plane.jpg"
              alt="logo"
              class="h-full w-full rounded-lg object-cover"
            />
          </div>
          <div class="relative h-[300px] rounded-lg bg-green-400">
            <div
              class="flex flex-col justify-end p-3"
              style={{
                position: 'absolute',
                top: 0,
                left: 0,
                bottom: 0,
                right: 0,
                background:
                  'radial-gradient(circle, rgba(0, 0, 0, 0.3) 65%, transparent 150%)',
                borderRadius: '0.5rem', // Adjust as needed
              }}
            >
              <div class="flex flex-col items-start gap-2">
                <span class="text-3xl font-extralight">Articles</span>
                <span class="text-6xl font-semibold">{articleCount}</span>
              </div>
            </div>
            <img
              src="https://www.stantec.com/content/dam/stantec/images/ideas/blogs/002/how-long-airport-runway-1.jpg"
              alt="logo"
              class="h-full w-full rounded-lg object-cover"
            />
          </div>
        </div>
        <div class="relative col-span-1 rounded-lg md:col-span-2">
          <div
            class="flex items-center justify-center"
            style={{
              position: 'absolute',
              top: 0,
              left: 0,
              bottom: 0,
              right: 0,
              background:
                'radial-gradient(circle, rgba(0, 0, 0, 0.5) 65%, transparent 150%)',
              borderRadius: '0.5rem', // Adjust as needed
            }}
          >
            <span class="text-3xl font-extralight">
              Helping you prosper in the skies <br />
            </span>
          </div>
          <img
            src="https://cdn.rohde-schwarz.com/image/market-segments/critical-infrastructures/air-traffic-control/airport/airport-tower-munich-scene-photo-rohde-schwarz_200_26587_2880_1620_19.jpg"
            alt="logo"
            class="h-full w-full rounded-lg object-cover"
          />
        </div>
      </div>
    </section>
    <Footer />
  </main>
</BaseLayout>
